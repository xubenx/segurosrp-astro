---
// Contact section component for Segubeca

const advisors = [
  {
    name: "Lic. Silvia Plascencia",
    specialty: "Asesora especializada en seguros educativos",
    image: "/asesor_1_small.webp",
    phone: "+52 (442) 595 8912",
    phoneHref: "tel:+524461354113"
  },
  {
    name: "Lic. Michelle Ram√≠rez",
    specialty: "Asesora especializada en seguros educativos",
    image: "/asesor_2_small.webp",
    phone: "+52 (446) 135 4113",
    phoneHref: "tel:+524461354113"
  },
  {
    name: "Lic. Jos√© Ram√≠rez",
    specialty: "Asesor especializado en seguros educativos",
    image: "/asesor_3_small.webp",
    phone: "+52 (442) 595 8912",
    phoneHref: "tel:+524461354113"
  }
];
---

<section id="contacto" style="
  background: linear-gradient(135deg, #0f1f32 0%, #145995 100%);
  position: relative;
  overflow: hidden;
  padding: 80px 0;
">
  <!-- Elementos de fondo espaciales -->
  <div style="
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-image: url('/segubecalanding/stars.png');
    background-position: center center;
    background-repeat: repeat;
    background-size: auto;
    opacity: 0.3;
    z-index: 1;
    pointer-events: none;
  "></div>

  <div class="container mx-auto px-4" style="position: relative; z-index: 2;">
    <h2 style="
      color: #FFDE59;
      text-align: center;
      margin-bottom: 3rem;
      font-size: clamp(2rem, 4vw, 3rem);
      font-weight: 700;
    ">
      üéì ¬°Asegura el futuro de tus hijos HOY!
    </h2>
    
    <p style="
      color: white;
      text-align: center;
      margin-bottom: 3rem;
      font-size: clamp(1rem, 2.5vw, 1.2rem);
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
    ">
      Completa el formulario y uno de nuestros asesores especializados en seguros educativos te contactar√° para dise√±ar el plan perfecto para tu familia.
    </p>
    
    <!-- Formulario e Im√°genes en 2 columnas -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12">
      <!-- Formulario de contacto -->
      <div style="
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 2rem;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      ">
        <form id="segubecaForm" class="space-y-4" method="POST">
          <div id="formMessage" class="hidden p-4 rounded-lg mb-4"></div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label for="parentName" style="
                display: block;
                font-size: 0.875rem;
                font-weight: 600;
                color: #145995;
                margin-bottom: 0.5rem;
              ">Tu Nombre *</label>
              <input 
                type="text" 
                id="parentName" 
                name="parentName" 
                required
                style="
                  width: 100%;
                  padding: 0.75rem;
                  border: 2px solid #e5e7eb;
                  border-radius: 10px;
                  font-size: 0.875rem;
                  transition: all 0.3s ease;
                "
                onfocus="this.style.borderColor='#FFDE59'; this.style.boxShadow='0 0 0 3px rgba(255, 222, 89, 0.1)'"
                onblur="this.style.borderColor='#e5e7eb'; this.style.boxShadow='none'"
              />
            </div>
            
            <div>
              <label for="childName" style="
                display: block;
                font-size: 0.875rem;
                font-weight: 600;
                color: #145995;
                margin-bottom: 0.5rem;
              ">Nombre de tu hij@ *</label>
              <input 
                type="text" 
                id="childName" 
                name="childName" 
                required
                style="
                  width: 100%;
                  padding: 0.75rem;
                  border: 2px solid #e5e7eb;
                  border-radius: 10px;
                  font-size: 0.875rem;
                  transition: all 0.3s ease;
                "
                onfocus="this.style.borderColor='#FFDE59'; this.style.boxShadow='0 0 0 3px rgba(255, 222, 89, 0.1)'"
                onblur="this.style.borderColor='#e5e7eb'; this.style.boxShadow='none'"
              />
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label for="parentAge" style="
                display: block;
                font-size: 0.875rem;
                font-weight: 600;
                color: #145995;
                margin-bottom: 0.5rem;
              ">Tu edad *</label>
              <input 
                type="number" 
                id="parentAge" 
                name="parentAge" 
                min="18" 
                max="80"
                required
                style="
                  width: 100%;
                  padding: 0.75rem;
                  border: 2px solid #e5e7eb;
                  border-radius: 10px;
                  font-size: 0.875rem;
                  transition: all 0.3s ease;
                "
                onfocus="this.style.borderColor='#FFDE59'; this.style.boxShadow='0 0 0 3px rgba(255, 222, 89, 0.1)'"
                onblur="this.style.borderColor='#e5e7eb'; this.style.boxShadow='none'"
              />
            </div>
            
            <div>
              <label for="childAge" style="
                display: block;
                font-size: 0.875rem;
                font-weight: 600;
                color: #145995;
                margin-bottom: 0.5rem;
              ">Edad de tu hij@ *</label>
              <input 
                type="number" 
                id="childAge" 
                name="childAge" 
                min="0" 
                max="17"
                required
                style="
                  width: 100%;
                  padding: 0.75rem;
                  border: 2px solid #e5e7eb;
                  border-radius: 10px;
                  font-size: 0.875rem;
                  transition: all 0.3s ease;
                "
                onfocus="this.style.borderColor='#FFDE59'; this.style.boxShadow='0 0 0 3px rgba(255, 222, 89, 0.1)'"
                onblur="this.style.borderColor='#e5e7eb'; this.style.boxShadow='none'"
              />
            </div>
          </div>

          <div>
            <label for="monthlySavings" style="
              display: block;
              font-size: 0.875rem;
              font-weight: 600;
              color: #145995;
              margin-bottom: 0.5rem;
            ">¬øCu√°nto te gustar√≠a ahorrar al mes? *</label>
            <select 
              id="monthlySavings" 
              name="monthlySavings" 
              required
              style="
                width: 100%;
                padding: 0.75rem;
                border: 2px solid #e5e7eb;
                border-radius: 10px;
                font-size: 0.875rem;
                transition: all 0.3s ease;
                background: white;
              "
              onfocus="this.style.borderColor='#FFDE59'; this.style.boxShadow='0 0 0 3px rgba(255, 222, 89, 0.1)'"
              onblur="this.style.borderColor='#e5e7eb'; this.style.boxShadow='none'"
            >
              <option value="">Selecciona una opci√≥n</option>
              <option value="3000-5000">$3,000 - $5,000 MXN</option>
              <option value="5000-10000">$5,000 - $10,000 MXN</option>
              <option value="10000+">M√°s de $10,000 MXN</option>
            </select>
          </div>
          
          <div>
            <label for="email" style="
              display: block;
              font-size: 0.875rem;
              font-weight: 600;
              color: #145995;
              margin-bottom: 0.5rem;
            ">Correo electr√≥nico *</label>
            <input 
              type="email" 
              id="email" 
              name="email" 
              required
              style="
                width: 100%;
                padding: 0.75rem;
                border: 2px solid #e5e7eb;
                border-radius: 10px;
                font-size: 0.875rem;
                transition: all 0.3s ease;
              "
              onfocus="this.style.borderColor='#FFDE59'; this.style.boxShadow='0 0 0 3px rgba(255, 222, 89, 0.1)'"
              onblur="this.style.borderColor='#e5e7eb'; this.style.boxShadow='none'"
            />
          </div>
          
          <div>
            <label for="whatsapp" style="
              display: block;
              font-size: 0.875rem;
              font-weight: 600;
              color: #145995;
              margin-bottom: 0.5rem;
            ">N√∫mero de WhatsApp *</label>
            <input 
              type="tel" 
              id="whatsapp" 
              name="whatsapp" 
              required
              placeholder="Ej: 5544332211"
              style="
                width: 100%;
                padding: 0.75rem;
                border: 2px solid #e5e7eb;
                border-radius: 10px;
                font-size: 0.875rem;
                transition: all 0.3s ease;
              "
              onfocus="this.style.borderColor='#FFDE59'; this.style.boxShadow='0 0 0 3px rgba(255, 222, 89, 0.1)'"
              onblur="this.style.borderColor='#e5e7eb'; this.style.boxShadow='none'"
            />
          </div>
          
          <button 
            type="submit" 
            id="submitButton"
            style="
              width: 100%;
              background: linear-gradient(135deg, #FFDE59, #FFD700);
              color: #145995;
              padding: 1rem;
              border-radius: 15px;
              font-weight: 700;
              font-size: 1rem;
              border: none;
              cursor: pointer;
              transition: all 0.3s ease;
              box-shadow: 0 8px 25px rgba(255, 222, 89, 0.4);
            "
            onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 12px 35px rgba(255, 222, 89, 0.6)'"
            onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 8px 25px rgba(255, 222, 89, 0.4)'"
          >
            <span id="buttonText">üéì Asegurar el futuro de mi hij@</span>
            <span id="buttonLoading" class="hidden">Enviando...</span>
          </button>

          <p style="
            font-size: 0.75rem;
            color: #145995;
            text-align: center;
            margin-top: 1rem;
          ">
            Al enviar este formulario, acepto ser contactado por un asesor especializado en seguros educativos
          </p>
        </form>
      </div>

      <!-- Cards de Asesores -->
      <div>
        <h3 style="
          font-size: clamp(1.5rem, 3vw, 2rem);
          font-weight: 700;
          color: #FFDE59;
          margin-bottom: 2rem;
          text-align: center;
        ">Nuestros Especialistas en Seguros Educativos</h3>
        <div class="space-y-6">
          {advisors.map((advisor) => (
            <div style="
              background: rgba(255, 255, 255, 0.1);
              backdrop-filter: blur(10px);
              border: 1px solid rgba(255, 222, 89, 0.3);
              border-radius: 15px;
              padding: 1.5rem;
              display: flex;
              align-items: center;
              gap: 1rem;
              transition: all 0.3s ease;
            "
            onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 15px 30px rgba(255, 222, 89, 0.2)'"
            onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'"
            >
              <div style="
                width: 80px;
                height: 80px;
                border-radius: 50%;
                overflow: hidden;
                border: 3px solid #FFDE59;
                flex-shrink: 0;
              ">
                <img 
                  src={advisor.image} 
                  alt={advisor.name}
                  width="80"
                  height="80"
                  loading="lazy"
                  style="
                    width: 100%;
                    height: 100%;
                    object-fit: cover;
                  "
                />
              </div>
              <div>
                <h4 style="
                  color: #FFDE59;
                  font-weight: 600;
                  margin-bottom: 0.5rem;
                ">{advisor.name}</h4>
                <p style="
                  color: white;
                  font-size: 0.875rem;
                  margin-bottom: 0.5rem;
                ">{advisor.specialty}</p>
                
              </div>
            </div>
          ))}
        </div>

        <!-- Llamada a la acci√≥n adicional -->
        <div style="
          background: rgba(255, 222, 89, 0.1);
          border: 2px solid #FFDE59;
          border-radius: 15px;
          padding: 1.5rem;
          text-align: center;
          margin-top: 2rem;
        ">
          <h4 style="
            color: #FFDE59;
            font-weight: 700;
            margin-bottom: 1rem;
          ">¬øNecesitas ayuda inmediata?</h4>
          <p style="
            color: white;
            margin-bottom: 1rem;
            font-size: 0.875rem;
          ">
            Cont√°ctanos directamente por WhatsApp
          </p>
            <a 
              href="https://wa.me/524461354113?text=Hola,%20me%20interesa%20conocer%20m√°s%20sobre%20Segubeca%20para%20asegurar%20la%20educaci√≥n%20de%20mi%20hijo" 
              target="_blank"
              onclick="if(typeof gtagSendEvent === 'function') { gtagSendEvent('https://wa.me/524461354113?text=Hola,%20me%20interesa%20conocer%20m√°s%20sobre%20Segubeca%20para%20asegurar%20la%20educaci√≥n%20de%20mi%20hijo'); return false; }"
              style="
                display: inline-block;
                background: #25D366;
                color: #ffffff;
                padding: 0.75rem 1.5rem;
                border-radius: 25px;
                text-decoration: none;
                font-weight: 700;
                transition: all 0.3s ease;
              "
            >
                Chatear por WhatsApp
            </a>
        </div>
      </div>
    </div>
  </div>
</section> 


<script>
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('segubecaForm') as HTMLFormElement;
    const formMessage = document.getElementById('formMessage') as HTMLElement;
    const submitButton = document.getElementById('submitButton') as HTMLButtonElement;
    const buttonText = document.getElementById('buttonText') as HTMLElement;
    const buttonLoading = document.getElementById('buttonLoading') as HTMLElement;

    if (!form || !formMessage || !submitButton || !buttonText || !buttonLoading) {
      console.error('Required form elements not found');
      return;
    }

    // Validar n√∫meros de WhatsApp
    const whatsappInput = document.getElementById('whatsapp') as HTMLInputElement;
    if (whatsappInput) {
      whatsappInput.addEventListener('input', function() {
        // Remover caracteres que no sean n√∫meros
        this.value = this.value.replace(/[^0-9]/g, '');
        
        // Limitar a 10 d√≠gitos
        if (this.value.length > 10) {
          this.value = this.value.slice(0, 10);
        }
      });
    }

    form.addEventListener('submit', async function(e) {
      e.preventDefault();
      
      // Deshabilitar el bot√≥n y mostrar loading
      submitButton.disabled = true;
      buttonText.classList.add('hidden');
      buttonLoading.classList.remove('hidden');
      
      // Ocultar mensajes anteriores
      formMessage.classList.add('hidden');
      
      // Obtener datos del formulario
      const formData = new FormData(form);
      const data = {
        parentName: formData.get('parentName') as string,
        childName: formData.get('childName') as string,
        parentAge: formData.get('parentAge') as string,
        childAge: formData.get('childAge') as string,
        monthlySavings: formData.get('monthlySavings') as string,
        email: formData.get('email') as string,
        whatsapp: formData.get('whatsapp') as string,
        source: 'Segubeca Landing',
        campaign: 'Seguros Educativos'
      };

      // Validaci√≥n adicional de WhatsApp
      if (data.whatsapp && data.whatsapp.length !== 10) {
        formMessage.className = 'p-4 rounded-lg mb-4 bg-red-100 text-red-800 border border-red-200';
        formMessage.textContent = 'El n√∫mero de WhatsApp debe tener exactamente 10 d√≠gitos';
        formMessage.classList.remove('hidden');
        
        // Restaurar el bot√≥n
        submitButton.disabled = false;
        buttonText.classList.remove('hidden');
        buttonLoading.classList.add('hidden');
        return;
      }

      try {
        const response = await fetch('/api/segubeca-contact', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });

        const result = await response.json();

        if (response.ok) {
          // √âxito
          formMessage.className = 'p-4 rounded-lg mb-4 bg-green-100 text-green-800 border border-green-200';
          
          // Enviar evento de conversi√≥n usando gtagSendEvent
          if (typeof (window as any).gtagSendEvent === 'function') {
            (window as any).gtagSendEvent(null); // No necesitamos redireccionar, solo enviar el evento
          } else if (typeof (window as any).gtag !== 'undefined') {
            // Fallback si gtagSendEvent no est√° disponible
            (window as any).gtag('event', 'click_formulario_segubeca', {
              'event_category': 'conversion',
              'event_label': 'Segubeca Contact Form Submit',
              'form_name': 'Segubeca Contact Form'
            });
          }
          
          // Enviar conversi√≥n adicional a Google Analytics GA4
          if (typeof (window as any).gtag !== 'undefined') {
            // Enviar conversi√≥n espec√≠fica a GA4
            (window as any).gtag('event', 'leads_segubeca', {
              'event_category': 'conversion',
              'event_label': 'Segubeca Contact Form',
              'form_name': 'Segubeca Contact Form'
            });
            
            // Tambi√©n enviar evento gen√©rico de formulario
            (window as any).gtag('event', 'submit', {
              'form_name': 'Segubeca Contact Form'
            });
          }
          // Mostrar mensaje personalizado seg√∫n el resultado
          if (result.details && result.details.errors && result.details.errors.length > 0) {
            // √âxito con advertencias
            formMessage.innerHTML = `
              <div style="display: flex; align-items: center; gap: 0.5rem;">
                <span style="font-size: 1.2rem;">‚úÖ</span>
                <div>
                  <strong>¬°Perfecto, ${data.parentName}!</strong><br>
                  <span style="font-size: 0.875rem;">Tu informaci√≥n fue guardada exitosamente. Nuestro asesor te contactar√° en las pr√≥ximas 24 horas para dise√±ar el plan ideal para ${data.childName}.</span>
                  <br><br>
                  <span style="font-size: 0.75rem; color: #d97706;">‚ÑπÔ∏è Nota: Algunas notificaciones autom√°ticas fallaron, pero tu solicitud fue procesada correctamente.</span>
                </div>
              </div>
            `;
          } else {
            // √âxito completo
            formMessage.innerHTML = `
              <div style="display: flex; align-items: center; gap: 0.5rem;">
                <span style="font-size: 1.2rem;">üéâ</span>
                <div>
                  <strong>¬°Perfecto, ${data.parentName}!</strong><br>
                  <span style="font-size: 0.875rem;">Nuestro asesor especializado en seguros educativos te contactar√° en las pr√≥ximas 24 horas para dise√±ar el plan ideal para ${data.childName}.</span>
                </div>
              </div>
            `;
          }
          
          formMessage.classList.remove('hidden');
          
          // Limpiar el formulario
          form.reset();

          // Scroll suave al mensaje
          formMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
          
        } else {
          // Error del servidor
          formMessage.className = 'p-4 rounded-lg mb-4 bg-red-100 text-red-800 border border-red-200';
          
          // Mostrar error espec√≠fico o gen√©rico
          const errorMessage = result.error || result.message || 'Error al enviar el formulario. Por favor, intenta de nuevo.';
          formMessage.innerHTML = `
            <div>
              <strong>‚ùå Error</strong><br>
              <span style="font-size: 0.875rem;">${errorMessage}</span>
              ${result.details && result.details.errors ? `<br><br><span style="font-size: 0.75rem; color: #991b1b;">Detalles t√©cnicos: ${result.details.errors.join(', ')}</span>` : ''}
            </div>
          `;
          formMessage.classList.remove('hidden');
        }
      } catch (error) {
        // Error de red o conexi√≥n
        console.error('Network/Connection error:', error);
        formMessage.className = 'p-4 rounded-lg mb-4 bg-red-100 text-red-800 border border-red-200';
        
        // Determinar tipo de error
        let errorMessage = '';
        if (error.name === 'TypeError' && error.message.includes('fetch')) {
          errorMessage = 'Error de conexi√≥n. Verifica tu conexi√≥n a internet e intenta de nuevo.';
        } else if (error.name === 'AbortError') {
          errorMessage = 'La solicitud fue cancelada. Por favor, intenta de nuevo.';
        } else {
          errorMessage = 'Error de comunicaci√≥n con el servidor. Por favor, intenta de nuevo.';
        }
        
        formMessage.innerHTML = `
          <div>
            <strong>üåê Error de Conexi√≥n</strong><br>
            <span style="font-size: 0.875rem;">${errorMessage}</span><br><br>
            <span style="font-size: 0.75rem;">Si el problema persiste, cont√°ctanos directamente por WhatsApp usando el bot√≥n verde en la parte inferior.</span>
          </div>
        `;
        formMessage.classList.remove('hidden');
      } finally {
        // Restaurar el bot√≥n
        submitButton.disabled = false;
        buttonText.classList.remove('hidden');
        buttonLoading.classList.add('hidden');
      }
    });
  });
</script>
